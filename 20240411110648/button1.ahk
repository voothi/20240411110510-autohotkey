; ====================================================================================
; --- Функции ---
; ====================================================================================

; Определяет скорость прокрутки для разных приложений
GetScrollCount() {
    if WinActive("ahk_exe chrome.exe") {
        return 3 ; Быстрее для Chrome
    }
    return 1 ; Стандартная скорость
}

; Выполняет саму прокрутку
ScrollDownTimer() {
    loop GetScrollCount() {
        ; ИЗМЕНЕНИЕ: {Blind} говорит команде игнорировать зажатые клавиши Ctrl/Alt/Shift.
        ; Это предотвращает масштабирование в VSCode и других программах.
        Send("{Blind}{WheelDown}")
        Sleep(50)
    }
}

; ====================================================================================
; --- Основная горячая клавиша ---
; ====================================================================================

; Этот единый хоткей обрабатывает ВСЕ ситуации.
; Он срабатывает при нажатии кнопки стилуса (которая эмулирует Ctrl+Alt+').
^!sc028::
{
    ; Проверяем, зажата ли ФИЗИЧЕСКАЯ клавиша Ctrl на клавиатуре.
    if GetKeyState("Control", "P")
    {
        ; --- РЕЖИМ ПРОКРУТКИ ---
        SetTimer(ScrollDownTimer, 50)
        
        ; Ждем, пока пользователь отпустит кнопку стилуса.
        KeyWait("sc028")
        
        ; Останавливаем прокрутку.
        SetTimer(ScrollDownTimer, 0)
    }
    else
    {
        ; --- РЕЖИМ КЛИКА И ВЫДЕЛЕНИЯ ---
        ; Мгновенно имитируем зажатие левой кнопки мыши.
        Send("{LButton Down}")
        
        ; Ждем, пока пользователь отпустит кнопку стилуса.
        KeyWait("sc028")
        
        ; Имитируем отпускание левой кнопки мыши.
        Send("{LButton Up}")
    }
    return
}