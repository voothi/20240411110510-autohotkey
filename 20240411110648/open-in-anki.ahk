#Requires AutoHotkey v2.0

; --- Пути к вашим файлам ---
pythonPath := "C:\Python\Python312\python.exe"
scriptPath := "C:\Tools\anki-search\anki-search.py"

; ===================================================================
; === ПРОВЕРКА ЗАПУСКА ИЗ КОМАНДНОЙ СТРОКИ ===
; ===================================================================
; Если скрипт был запущен с параметром "/trigger",
; он выполнит действие и сразу закроется.
if A_Args.Length > 0 && A_Args[1] == "/trigger"
{
    PerformAnkiAction()
    ExitApp ; Важно: закрываем "одноразовый" скрипт
}

; Если параметров нет, скрипт остается работать в фоне и ждет горячую клавишу.

; ===================================================================
; === ГОРЯЧАЯ КЛАВИША (ДЛЯ ФОНОВОГО РЕЖИМА) ===
; ===================================================================
#HotIf WinActive("ahk_exe goldendict.exe")
^!a::
{
    PerformAnkiAction()
}
#HotIf

; ===================================================================
; === ОСНОВНАЯ ФУНКЦИЯ, КОТОРАЯ ДЕЛАЕТ ВСЮ РАБОТУ ===
; ===================================================================
PerformAnkiAction()
{
    ; GoldenDict автоматически копирует выделенный текст перед запуском программы.
    ; Поэтому нам нужно просто прочитать буфер обмена.
    if !A_Clipboard
    {
        ; Если буфер пуст, ничего не делаем
        Return
    }

    ; Формируем команду и запускаем Python-скрипт в скрытом режиме
    local command := '"' . pythonPath . '" "' . scriptPath . '" --browse-clipboard'
    Run(command,, "Hide")

    ; Ждём появления окна браузера Anki и активируем его
    if WinWait("Browse ahk_exe anki.exe",, 2)
    {
        WinActivate("Browse ahk_exe anki.exe")
    }
}