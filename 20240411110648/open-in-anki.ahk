; #Requires AutoHotkey v2.0

; =================================================================================
; --- НАСТРОЙКА ---
; Укажите полные пути к вашему интерпретатору Python и к скрипту anki-search.py
; =================================================================================

; Пример: pythonPath := "C:\Users\User\AppData\Local\Programs\Python\Python311\python.exe"
pythonPath := "C:\Python\Python312\python.exe"

; Пример: scriptPath := "D:\Мои Скрипты\anki-search.py"
scriptPath := "C:\Tools\anki-search\anki-search.py"


; =================================================================================
; --- ГОРЯЧАЯ КЛАВИША ---
; ^!a означает Ctrl + Alt + A. Вы можете изменить на любую удобную комбинацию.
; Символы: ^ (Ctrl), ! (Alt), + (Shift), # (Win)
; =================================================================================

^!a::
{
    ; 1. Сохраняем текущее содержимое буфера обмена, чтобы не потерять его
    local savedClipboard := A_ClipboardAll
    A_Clipboard := "" ; Очищаем буфер для надежной работы ClipWait

    ; 2. Копируем выделенный текст (отправляем команду Ctrl+C)
    SendInput "^c"
    
    ; 3. Ждём, пока текст появится в буфере обмена (не дольше 1 секунды)
    if !ClipWait(1)
    {
        MsgBox "Не удалось скопировать выделенный текст. Пожалуйста, выделите текст и попробуйте снова."
        Return ; Прерываем выполнение, если копирование не удалось
    }

    ; 4. Формируем и запускаем команду для Python-скрипта в скрытом режиме
    ; Скрипт использует ключ --browse-clipboard, чтобы прочитать скопированный текст
    local command := '"' . pythonPath . '" "' . scriptPath . '" --browse-clipboard'
    Run(command,, "Hide")

    ; 5. Восстанавливаем исходное содержимое буфера обмена
    ; Небольшая задержка, чтобы Python-скрипт успел прочитать буфер
    Sleep(300) 
    A_Clipboard := savedClipboard
}


; =================================================================================
; --- (ОПЦИОНАЛЬНО) Ограничение работы скрипта только для GoldenDict ---
; Чтобы горячая клавиша ^!a работала только в окне GoldenDict,
; раскомментируйте (удалите ;) следующие строки.
; =================================================================================

; #HotIf WinActive("ahk_class GoldenDict-ng")
; ^!a::
; {
;     ; Весь код из блока выше нужно будет скопировать сюда
;     local savedClipboard := A_ClipboardAll
;     A_Clipboard := ""
;     SendInput "^c"
;     if !ClipWait(1)
;     {
;         MsgBox "Не удалось скопировать выделенный текст."
;         Return
;     }
;     local command := '"' . pythonPath . '" "' . scriptPath . '" --browse-clipboard'
;     Run(command,, "Hide")
;     Sleep(300) 
;     A_Clipboard := savedClipboard
; }
; #HotIf