#Requires AutoHotkey v2.0

; =================================================================================
; --- НАСТРОЙКА ---
; Пути к Python и вашему скрипту. Я использовал те, что вы указали.
; =================================================================================
pythonPath := "C:\Python\Python312\python.exe"
scriptPath := "C:\Tools\anki-search\anki-search.py"


; =================================================================================
; --- ГОРЯЧАЯ КЛАВИША ДЛЯ GOLDENDICT ---
; Горячая клавиша ^!a (Ctrl + Alt + A) будет работать ТОЛЬКО в окне GoldenDict.
; =================================================================================
#HotIf WinActive("ahk_class GoldenDict-ng")

^!a::
{
    ; 1. Сохраняем текущее содержимое буфера обмена, чтобы не потерять его.
    local savedClipboard := A_ClipboardAll
    A_Clipboard := "" ; Очищаем буфер для надежного копирования.

    ; 2. Копируем выделенный текст.
    SendInput("^c")
    
    ; 3. Ждём до 1 секунды, пока текст не появится в буфере обмена.
    if !ClipWait(1)
    {
        MsgBox("Ошибка: Не удалось скопировать выделенный текст.")
        Return ; Останавливаем скрипт, если копирование не удалось.
    }

    ; 4. Формируем и запускаем команду для Python-скрипта в скрытом режиме.
    local command := '"' . pythonPath . '" "' . scriptPath . '" --browse-clipboard'
    Run(command,, "Hide")

    ; 5. Возвращаем исходное содержимое в буфер обмена.
    Sleep(300) ; Небольшая задержка, чтобы Python успел прочитать буфер.
    A_Clipboard := savedClipboard
}

#HotIf ; Завершаем секцию для GoldenDict.